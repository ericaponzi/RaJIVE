---
title: "RaJIVE"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{RaJIVE}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>", 
  cache=TRUE
)
```

```{r setup}
library("RaJIVE")
```

## Data
We simulate data using the function jive.data.sim contained in the RaJIVE package: 

```{r}
n <- 100

# dimension of data set 
p1 <- 100
p2 <- 180
p3 <- 150
pks <- c(p1, p2, p3)
Y <- jive.data.sim(K =3, rankJ = 3, rankA = c(10, 12, 7), n = n,
                   pks = pks, dist.type = 1)

initial_signal_ranks = c(10, 12, 7)
data.ajive <- list((Y$sim_data[[1]]), (Y$sim_data[[2]]), (Y$sim_data[[3]]))

```



## Standard aJIVE

We first apply the standard aJIVE to the simulated dataset: 

```{r}
ajive_decomp <- ajive(data.ajive, initial_signal_ranks)

```


Selected joint rank:
```{r}
ajive_decomp$joint_rank
```
Selected individual ranks: 
```{r}
ajive_decomp$block_decomps[[1]]$individual$rank
ajive_decomp$block_decomps[[2]]$individual$rank
ajive_decomp$block_decomps[[3]]$individual$rank
```


## Generate some outliers in the data

```{r}
# generate some outliers in the simulated data
  # outliers in p/5 variables 
  # all three data sources
   
  cond   <- sample(n, 0.1*n)
  
  Y_outliers1 <- Y$sim_data[[1]]
  pstar1 <- sample(pks[1], pks[1]*0.05)
  Y_outliers1[cond, pstar1] <- Y_outliers1[cond, pstar1] + rnorm(0.1*n*pstar1, 15 , 1)  
  
  
  Y_outliers2 <- Y$sim_data[[2]]
  pstar2 <- sample(pks[2], pks[2]*0.05)
  Y_outliers2[cond, pstar2] <- Y_outliers2[cond, pstar2] + rnorm(0.1*n*pstar2, 15 , 1)  
  
  
  Y_outliers3<- Y$sim_data[[3]]
  pstar3 <- sample(pks[3], pks[3]*0.05)
  Y_outliers3[cond, pstar3] <- Y_outliers3[cond, pstar3] + rnorm(0.1*n*pstar3, 15 , 1)  
  
  Y_outliers <- list(Y_outliers1, 
                     Y_outliers2, 
                     Y_outliers3)
  
```

## Standard aJIVE on data with outliers

We first apply the standard aJIVE: 

```{r}
ajive_decomp_out <- ajive(Y_outliers, initial_signal_ranks)

```



Selected joint rank:
```{r}
ajive_decomp_out$joint_rank
```
Selected individual ranks: 
```{r}
ajive_decomp_out$block_decomps[[1]]$individual$rank
ajive_decomp_out$block_decomps[[2]]$individual$rank
ajive_decomp_out$block_decomps[[3]]$individual$rank
```



## Robust aJIVE
We run robust aJIVE: 

```{r}
ajive.results.robust.out <- Rajive(Y_outliers, initial_signal_ranks)
```


Selected joint rank:
```{r}
get_joint_rank(ajive.results.robust.out)

```
Selected individual ranks: 
```{r}
get_individual_rank(ajive.results.robust.out, 1)
get_individual_rank(ajive.results.robust.out, 2)
get_individual_rank(ajive.results.robust.out, 3)

```

